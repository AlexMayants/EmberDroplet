"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e,t){var r={NONE:0,VALID:1,INVALID:2,DELETED:4,UPLOADED:8,FAILED:16},n=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),this.file=t,this.statusType=r.NONE}return _createClass(e,[{key:"getMIMEType",value:function(){return this.file.type}},{key:"getFileSize",value:function(){return this.file.size||0}},{key:"setStatusType",value:function(e){this.statusType=Number(e)}}]),e}(),i={PUSH:"push",SET:"set"},s=t.String.w("files.length","files.@each.statusType"),a={URL_REQUIRED:"Droplet: You must specify the URL parameter when constructing your component."};e.Droplet=t.Mixin.create({url:function(){throw new Error(a.URL_REQUIRED)},options:{maximumSize:1/0,includeHeader:!0},hooks:{didAdd:function(){},didDelete:function(){},didUpload:function(){}},files:[],model:n,mimeTypes:["image/jpeg","image/jpg","image/gif","image/png","image/tiff","image/bmp"],statusTypes:r,init:function(){t.set(this,"files",[]),this._super()},uploadStatus:t.computed(function(){return{uploading:!1,percentComplete:0,error:!1}}),validFiles:t.computed(function(){return this.getFiles(r.VALID)}).property(s),invalidFiles:t.computed(function(){return this.getFiles(r.INVALID)}).property(s),uploadedFiles:t.computed(function(){return this.getFiles(r.UPLOADED)}).property(s),deletedFiles:t.computed(function(){return this.getFiles(r.DELETED)}).property(s),requestSize:t.computed(function(){return t.get(this,"validFiles").reduce(function(e,t){return e+t.getFileSize()},0)}).property(s),getFiles:function(e){return this.files.filter(function(t){return t.statusType&e})},actions:{uploadFiles:function(){var e=this,n=function(r){return"function"==typeof t.get(e,"url")},i=(n(t.get(this,"url"))?t.get(this,"url").apply(this):t.get(this,"url"),t.get(this,"files").filter(function(e){return e.statusType&r.VALID}));return new t.RSVP.Promise(function(e,t){e({files:i})}).then(function(r){var n;(n=t.get(e,"hooks")).didUpload.apply(n,_toConsumableArray(r.files))},function(e,t,r){})},abortUpload:function(){},mimeTypes:function(e){var r=arguments.length<=1||void 0===arguments[1]?i.PUSH:arguments[1];r===i.SET&&t.set(this,"mimeTypes",[]),e=Array.isArray(e)?e:[e];var n=[].concat(_toConsumableArray(t.get(this,"mimeTypes")),_toConsumableArray(e));t.set(this,"mimeTypes",n)},addFiles:function(){for(var e,i=this,s=function(e){return!!~t.get(i,"mimeTypes").indexOf(e)},a=arguments.length,o=Array(a),u=0;a>u;u++)o[u]=arguments[u];var l=o.map(function(e){return e instanceof n?(e.setStatusType(s(e.getMIMEType())?r.VALID:r.INVALID),t.get(i,"files").pushObject(e),e):void 0}).filter(function(e){return"undefined"!=typeof e});l.length&&(e=t.get(this,"hooks")).didAdd.apply(e,_toConsumableArray(l))},deleteFiles:function(){for(var e,i=this,s=arguments.length,a=Array(s),o=0;s>o;o++)a[o]=arguments[o];var u=a.map(function(e){var s=!!~t.get(i,"files").indexOf(e);return s&&e instanceof n?(e.setStatusType(r.DELETED),t.get(i,"files").removeObject(e),e):void 0}).filter(function(e){return"undefined"!=typeof e});u.length&&(e=t.get(this,"hooks")).didDelete.apply(e,_toConsumableArray(u))},clearFiles:function(){var e=this;this.files.forEach(function(t){return e.send("deleteFiles",t)}),this.files.length=0}}});var o=e.Droplet.squashEvent=function(e){e.preventDefault(),e.stopPropagation()};e.DropletArea=t.Mixin.create({classNames:["droppable"],parentView:function(){return this.context.get("parentView")},drop:function(e){o(e),this.traverseFiles(e.dataTransfer.files)},traverseFiles:function(e){e=Array.from?Array.from(e):Array.prototype.slice.call(e);var t=e.reduce(function(e,t){new n(t);return e},[]);this.parentView().send("addFiles",t)},isValid:function(e){{var t=this.parentView().get("options");Number(t.maximumSize)}return!0},dragEnter:o,dragOver:o,dragLeave:o})}(window,window.Ember);